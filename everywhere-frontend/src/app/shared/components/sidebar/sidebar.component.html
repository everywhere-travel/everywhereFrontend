<!-- Sidebar Component -->
<aside
  class="fixed left-0 top-0 h-screen bg-white shadow-2xl border-r border-gray-200 transition-all duration-300 z-50 flex flex-col"
  [class.w-72]="!isCollapsed" [class.w-20]="isCollapsed">
  <!-- Sidebar Header -->
  <div class="flex items-center justify-between p-6 border-b border-gray-200 flex-shrink-0"
    [class.justify-center]="isCollapsed">

    <!-- Logo - siempre clickeable -->
    <button (click)="onToggleSidebar()" class="flex items-center gap-3 hover:opacity-80 transition-opacity">
      <div
        class="bg-gradient-to-r from-everywhere-primary to-everywhere-secondary rounded-xl flex items-center justify-center"
        [class.w-10]="!isCollapsed" [class.h-10]="!isCollapsed" [class.w-8]="isCollapsed" [class.h-8]="isCollapsed">
        <i class="fas fa-plane text-white" [class.text-lg]="!isCollapsed" [class.text-sm]="isCollapsed"></i>
      </div>
      <div *ngIf="!isCollapsed">
        <h2 class="text-xl font-bold text-gray-800">Everywhere</h2>
        <p class="text-xs text-gray-500 uppercase tracking-wide">Travel Sistema</p>
      </div>
    </button>

    <!-- Botón toggle adicional solo cuando expandido -->
    <button (click)="onToggleSidebar()" *ngIf="!isCollapsed"
      class="w-8 h-8 rounded-lg flex items-center justify-center hover:bg-gray-100 transition-colors">
      <i class="fas fa-chevron-left text-gray-600"></i>
    </button>
  </div>

  <!-- Navigation Menu -->
  <nav class="flex-1 overflow-y-auto overflow-x-hidden p-4 min-h-0">
    <div class="space-y-2">
      <div *ngFor="let item of menuItems" class="relative">
        <!-- Main Menu Item -->
        <button (click)="onItemClick(item)"
          class="w-full text-gray-700 hover:bg-gray-50 transition-all duration-200 group relative rounded-xl"
          [class.flex]="!isCollapsed" [class.items-center]="!isCollapsed" [class.gap-3]="!isCollapsed"
          [class.px-4]="!isCollapsed" [class.py-3]="!isCollapsed" [class.text-left]="!isCollapsed"
          [class.flex-col]="isCollapsed" [class.justify-center]="isCollapsed" [class.items-center]="isCollapsed"
          [class.py-4]="isCollapsed" [class.px-2]="isCollapsed" [class.bg-gradient-to-r]="item.active"
          [class.from-everywhere-primary/10]="item.active" [class.to-everywhere-secondary/10]="item.active"
          [class.text-everywhere-primary]="item.active" [class.shadow-sm]="item.active"
          [title]="isCollapsed ? item.title : ''">
          <!-- Icon -->
          <div class="flex items-center justify-center flex-shrink-0" [class.w-6]="!isCollapsed"
            [class.h-6]="!isCollapsed" [class.w-8]="isCollapsed" [class.h-8]="isCollapsed"
            [class.text-everywhere-primary]="item.active">
            <i [class]="item.icon" class="text-lg"></i>
          </div>

          <!-- Tooltip for collapsed state -->
          <div *ngIf="isCollapsed"
            class="absolute left-full ml-2 px-3 py-2 bg-gray-800 text-white text-sm rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-50">
            {{ item.title }}
            <div
              class="absolute left-0 top-1/2 transform -translate-y-1/2 -translate-x-1 w-2 h-2 bg-gray-800 rotate-45">
            </div>
          </div>

          <!-- Title and Badge -->
          <div class="flex-1" *ngIf="!isCollapsed">
            <div class="flex items-center justify-between">
              <span class="font-medium">{{ item.title }}</span>

              <!-- Badge -->
              <span *ngIf="item.badge" class="px-2 py-1 text-xs font-bold rounded-full"
                [class.bg-everywhere-primary/10]="item.badgeColor === 'red'"
                [class.text-everywhere-primary]="item.badgeColor === 'red'"
                [class.bg-green-100]="item.badgeColor === 'green'" [class.text-green-600]="item.badgeColor === 'green'"
                [class.bg-everywhere-blue/10]="item.badgeColor === 'blue'"
                [class.text-everywhere-blue]="item.badgeColor === 'blue'" [class.bg-gray-100]="!item.badgeColor"
                [class.text-gray-600]="!item.badgeColor">
                {{ item.badge }}
              </span>

              <!-- Expand Arrow -->
              <i *ngIf="item.children && item.children.length > 0"
                class="fas fa-chevron-down text-xs transition-transform duration-200"
                [class.rotate-180]="isExpanded(item.id)"></i>
            </div>
          </div>
        </button>

        <!-- Submenu -->
        <div *ngIf="item.children && item.children.length > 0 && isExpanded(item.id) && !isCollapsed"
          class="ml-6 mt-2 space-y-1 border-l-2 border-gray-100 pl-4">
          <a *ngFor="let child of item.children" [routerLink]="child.route"
            routerLinkActive="bg-everywhere-primary/10 text-everywhere-primary font-medium"
            class="flex items-center gap-3 px-3 py-2 text-sm text-gray-600 rounded-lg hover:bg-gray-50 transition-colors">
            <i [class]="child.icon" class="text-base"></i>
            <span>{{ child.title }}</span>
            <span *ngIf="child.badge"
              class="ml-auto px-2 py-1 text-xs font-bold rounded-full bg-gray-100 text-gray-600">
              {{ child.badge }}
            </span>
          </a>
        </div>
      </div>
    </div>
  </nav>

  <div class="border-t border-gray-200 flex-shrink-0">
    <!-- Widget expandido -->
    <div class="p-4" *ngIf="!isCollapsed">
      <div class="bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl p-3 border border-green-200">
        <div class="flex items-center justify-between mb-2">
          <div class="flex items-center gap-2">
            <div class="w-6 h-6 bg-green-600 rounded-lg flex items-center justify-center">
              <i class="fas fa-dollar-sign text-white text-xs"></i>
            </div>
            <h3 class="text-xs font-bold text-gray-800 uppercase tracking-wide">Tipo de Cambio</h3>
          </div>
          <button (click)="refreshExchangeRate()" [disabled]="isLoadingExchange"
            class="w-6 h-6 flex items-center justify-center rounded-lg hover:bg-green-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
            title="Actualizar tipo de cambio">
            <i class="fas fa-sync-alt text-green-700 text-xs" [class.fa-spin]="isLoadingExchange"></i>
          </button>
        </div>
        <!-- Loading state -->
        <div *ngIf="isLoadingExchange" class="text-center py-2">
          <p class="text-xs text-gray-600">Cargando...</p>
        </div>
        <!-- Error state -->
        <div *ngIf="exchangeError && !isLoadingExchange" class="text-center py-2">
          <p class="text-xs text-red-600">Error al cargar</p>
        </div>
        <!-- Data display -->
        <div *ngIf="exchangeData && !isLoadingExchange && !exchangeError" class="space-y-1.5">
          <div class="flex justify-between items-center">
            <span class="text-xs text-gray-600 font-medium">Compra:</span>
            <span class="text-sm font-bold text-green-700">S/ {{ exchangeData.buy }}</span>
          </div>
          <div class="flex justify-between items-center">
            <span class="text-xs text-gray-600 font-medium">Venta:</span>
            <span class="text-sm font-bold text-green-700">S/ {{ exchangeData.sell }}</span>
          </div>
          <div class="text-center pt-1 border-t border-green-200 mt-2">
            <a href="https://www.cambiomundial.com/" target="_blank" rel="noopener noreferrer"
              class="text-xs text-gray-500 hover:text-green-700 transition-colors">
              Fuente: Cambio Mundial
            </a>
          </div>
        </div>
      </div>
    </div>
    <!-- Widget colapsado -->
    <div class="p-3 flex justify-center relative group" *ngIf="isCollapsed">
      <button (click)="refreshExchangeRate()" [disabled]="isLoadingExchange"
        class="w-10 h-10 bg-gradient-to-r from-green-500 to-emerald-500 rounded-xl flex items-center justify-center hover:opacity-80 transition-opacity disabled:opacity-50 disabled:cursor-not-allowed"
        title="Tipo de cambio - Click para actualizar">
        <i class="fas fa-dollar-sign text-white" [class.fa-spin]="isLoadingExchange"></i>
      </button>
      <!-- Tooltip expandido -->
      <div
        class="absolute left-full ml-2 bg-gray-800 text-white text-xs rounded-lg p-3 opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-50 min-w-48">
        <div class="font-bold mb-1.5 border-b border-gray-600 pb-1">Tipo de Cambio</div>
        <div *ngIf="exchangeData && !isLoadingExchange && !exchangeError" class="space-y-1">
          <div class="flex justify-between gap-3">
            <span>Compra:</span>
            <span class="font-bold">S/ {{ exchangeData.buy }}</span>
          </div>
          <div class="flex justify-between gap-3">
            <span>Venta:</span>
            <span class="font-bold">S/ {{ exchangeData.sell }}</span>
          </div>
          <div class="text-center pt-1 border-t border-green-200 mt-2">
            <a href="https://www.cambiomundial.com/" target="_blank" rel="noopener noreferrer"
              class="text-xs text-gray-500 hover:text-green-700 transition-colors">
              Fuente: Cambio Mundial
            </a>
          </div>
        </div>
        <div *ngIf="isLoadingExchange">Cargando...</div>
        <div *ngIf="exchangeError && !isLoadingExchange">Error al cargar</div>
        <div class="absolute left-0 top-1/2 transform -translate-y-1/2 -translate-x-1 w-2 h-2 bg-gray-800 rotate-45">
        </div>
      </div>
    </div>
  </div>

  <!-- Sidebar Footer -->
  <div class="border-t border-gray-200 flex-shrink-0">
    <!-- Footer expandido -->
    <div class="p-4" *ngIf="!isCollapsed">
      <div class="flex items-center gap-3 p-3 bg-gray-50 rounded-xl">
        <div
          class="w-8 h-8 bg-gradient-to-r from-everywhere-blue to-everywhere-primary rounded-full flex items-center justify-center">
          <span class="text-white text-sm font-semibold">{{ getUserInitials() }}</span>
        </div>
        <div class="flex-1 min-w-0">
          <p class="text-sm font-medium text-gray-800 truncate">{{ getCurrentUser().name }}</p>
          <p class="text-xs text-gray-500">{{ getCurrentUser().role }}</p>
        </div>
        <div class="relative">
          <button (click)="toggleUserMenu()"
            class="w-6 h-6 flex items-center justify-center hover:bg-gray-200 rounded-lg transition-colors">
            <i class="fas fa-ellipsis-v text-gray-400 text-xs"></i>
          </button>
          <!-- Menu de usuario -->
          <div *ngIf="showUserMenu"
            class="absolute bottom-full right-0 mb-2 bg-white border border-gray-200 rounded-xl shadow-xl min-w-48 z-50">
            <button (click)="logout()"
              class="w-full flex items-center gap-3 px-4 py-3 text-red-600 hover:bg-red-50 transition-colors text-sm font-medium">
              <i class="fas fa-sign-out-alt"></i>
              <span>Cerrar Sesión</span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer colapsado -->
    <div class="p-3 flex justify-center" *ngIf="isCollapsed">
      <div class="relative">
        <button (click)="toggleUserMenu()"
          class="w-10 h-10 bg-gradient-to-r from-everywhere-blue to-everywhere-primary rounded-full flex items-center justify-center hover:opacity-80 transition-opacity">
          <span class="text-white text-sm font-semibold">{{ getUserInitials() }}</span>
        </button>
        <!-- Menu de usuario colapsado -->
        <div *ngIf="showUserMenu"
          class="absolute bottom-0 left-full ml-2 bg-white border border-gray-200 rounded-xl shadow-xl min-w-48 z-50">
          <div class="px-4 py-3 border-b border-gray-100">
            <p class="text-sm font-medium text-gray-800">{{ getCurrentUser().name }}</p>
            <p class="text-xs text-gray-500">{{ getCurrentUser().role }}</p>
          </div>
          <button (click)="logout()"
            class="w-full flex items-center gap-3 px-4 py-3 text-red-600 hover:bg-red-50 transition-colors text-sm font-medium">
            <i class="fas fa-sign-out-alt"></i>
            <span>Cerrar Sesión</span>
          </button>
        </div>
      </div>
    </div>
  </div>
</aside>

<!-- Overlay for mobile -->
<div *ngIf="!isCollapsed" class="fixed inset-0 bg-black/20 backdrop-blur-sm lg:hidden z-40" (click)="onToggleSidebar()">
</div>