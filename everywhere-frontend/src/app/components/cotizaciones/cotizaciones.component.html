<div class="container">
  <div class="page-header">
    <h1>Gestión de Cotizaciones</h1>
    <p>Administra cotizaciones de paquetes turísticos</p>
  </div>

   Search Section 
  <div class="search-section">
    <form [formGroup]="searchForm" class="search-container">
      <select formControlName="searchType" class="form-input search-select">
        <option value="numero">Por Número</option>
        <option value="cliente">Por Cliente</option>
      </select>
      <input
        type="text"
        formControlName="searchValue"
        (keyup.enter)="searchCotizaciones()"
        placeholder="Buscar cotización..."
        class="form-input search-input"
      />
      <button type="button" (click)="searchCotizaciones()" class="btn btn-primary">
        Buscar
      </button>
      <button type="button" (click)="toggleForm()" class="btn btn-secondary">
        {{ showForm ? 'Cancelar' : 'Nueva Cotización' }}
      </button>
    </form>
  </div>

   Form Section 
  <div *ngIf="showForm" class="form-section">
    <div class="card">
      <h3>{{ editingId ? 'Editar' : 'Nueva' }} Cotización</h3>
      
      <form [formGroup]="cotizacionForm" (ngSubmit)="onSubmit()">
         Basic Information 
        <div class="form-section-title">Información Básica</div>
        
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Número de Cotización *</label>
            <input type="text" formControlName="numero" class="form-input" readonly />
          </div>
          <div class="form-group">
            <label class="form-label">Cliente *</label>
            <select formControlName="personaId" class="form-input">
              <option value="">Seleccionar cliente...</option>
              <option *ngFor="let persona of personas" [value]="persona.id">
                {{ persona.nombre }} {{ persona.apellido }}
              </option>
            </select>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Fecha Cotización *</label>
            <input type="date" formControlName="fechaCotizacion" class="form-input" />
          </div>
          <div class="form-group">
            <label class="form-label">Estado *</label>
            <select formControlName="estado" class="form-input">
              <option *ngFor="let estado of estados" [value]="estado.value">
                {{ estado.label }}
              </option>
            </select>
          </div>
        </div>

         Travel Information 
        <div class="form-section-title">Información del Viaje</div>
        
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Fecha de Viaje</label>
            <input type="date" formControlName="fechaViaje" class="form-input" />
          </div>
          <div class="form-group">
            <label class="form-label">Fecha de Retorno</label>
            <input type="date" formControlName="fechaRetorno" class="form-input" />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Número de Adultos *</label>
            <input type="number" formControlName="numeroAdultos" min="1" class="form-input" />
          </div>
          <div class="form-group">
            <label class="form-label">Número de Niños</label>
            <input type="number" formControlName="numeroNinos" min="0" class="form-input" />
          </div>
        </div>

         Financial Information 
        <div class="form-section-title">Información Financiera</div>
        
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Moneda *</label>
            <select formControlName="moneda" class="form-input">
              <option *ngFor="let moneda of monedas" [value]="moneda.value">
                {{ moneda.label }}
              </option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Tipo de Cambio *</label>
            <input type="number" formControlName="tipoCambio" step="0.01" min="0.01" class="form-input" />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Forma de Pago *</label>
            <select formControlName="formaPago" class="form-input">
              <option *ngFor="let forma of formasPago" [value]="forma.value">
                {{ forma.label }}
              </option>
            </select>
          </div>
        </div>

         Products Section 
        <div class="form-section-title">Productos y Servicios</div>
        
        <div class="products-section">
          <div class="section-header">
            <h4>Productos Fijos</h4>
            <button type="button" (click)="addProduct()" class="btn btn-outline btn-sm">
              Agregar Producto
            </button>
          </div>

          <div *ngIf="productosSeleccionados.length === 0" class="empty-message">
            No hay productos agregados
          </div>

          <table *ngIf="productosSeleccionados.length > 0" class="table products-table">
            <thead>
              <tr>
                <th>Descripción</th>
                <th>Cantidad</th>
                <th>Precio Unit.</th>
                <th>Subtotal</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let producto of productosSeleccionados; let i = index">
                <td>
                  <input
                    type="text"
                    [(ngModel)]="producto.descripcion"
                    [ngModelOptions]="{standalone: true}"
                    class="form-input"
                    placeholder="Descripción del producto"
                  />
                </td>
                <td>
                  <input
                    type="number"
                    [(ngModel)]="producto.cantidad"
                    [ngModelOptions]="{standalone: true}"
                    (ngModelChange)="updateProductSubtotal(i)"
                    min="1"
                    class="form-input quantity-input"
                  />
                </td>
                <td>
                  <input
                    type="number"
                    [(ngModel)]="producto.precioUnitario"
                    [ngModelOptions]="{standalone: true}"
                    (ngModelChange)="updateProductSubtotal(i)"
                    step="0.01"
                    min="0"
                    class="form-input price-input"
                  />
                </td>
                <td class="subtotal-cell">
                  {{ producto.subtotal | currency:'PEN':'symbol':'1.2-2' }}
                </td>
                <td>
                  <button type="button" (click)="removeProduct(i)" class="btn btn-sm btn-error">
                    Eliminar
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

         Hotel Groups Section 
        <div class="hotel-groups-section">
          <div class="section-header">
            <h4>Grupos de Hoteles (Dinámico)</h4>
          </div>

          <div *ngIf="gruposHoteles.length === 0" class="empty-message">
            No hay grupos de hoteles disponibles
          </div>

          <div *ngFor="let grupo of gruposHoteles" class="hotel-group-card">
            <div class="group-header">
              <label class="checkbox-label">
                <input
                  type="checkbox"
                  [checked]="isGrupoSelected(grupo.id!)"
                  (change)="toggleGrupoHotel(grupo)"
                />
                <span class="group-name">{{ grupo.nombre }}</span>
              </label>
            </div>

            <div *ngIf="isGrupoSelected(grupo.id!)" class="hotels-grid">
              <div *ngFor="let hotel of grupo.hoteles; let gi = index" class="hotel-card">
                <label class="checkbox-label">
                  <input
                    type="checkbox"
                    [checked]="hotel.seleccionado"
                    (change)="toggleHotelInGroup(gruposSeleccionados.findIndex(g => g.id === grupo.id), hotel)"
                  />
                  <div class="hotel-info">
                    <div class="hotel-name">{{ hotel.nombre }}</div>
                    <div class="hotel-details">
                      <span class="hotel-category">{{ hotel.categoria }}★</span>
                      <span class="hotel-location">{{ hotel.ubicacion }}</span>
                      <span class="hotel-price">{{ hotel.precioNoche | currency:'PEN':'symbol':'1.2-2' }}/noche</span>
                    </div>
                  </div>
                </label>
              </div>
            </div>
          </div>
        </div>

         Summary Section 
        <div class="summary-section">
          <div class="summary-card">
            <h4>Resumen Financiero</h4>
            <div class="summary-row">
              <span>Subtotal:</span>
              <span>{{ calculateSubtotal() | currency:'PEN':'symbol':'1.2-2' }}</span>
            </div>
            <div class="summary-row">
              <span>IGV (18%):</span>
              <span>{{ calculateTaxes() | currency:'PEN':'symbol':'1.2-2' }}</span>
            </div>
            <div class="summary-row total-row">
              <span>Total:</span>
              <span>{{ calculateTotal() | currency:'PEN':'symbol':'1.2-2' }}</span>
            </div>
          </div>
        </div>

         Observations 
        <div class="form-group">
          <label class="form-label">Observaciones</label>
          <textarea formControlName="observaciones" class="form-input" rows="3" placeholder="Observaciones adicionales..."></textarea>
        </div>

        <div class="form-actions">
          <button type="submit" [disabled]="!cotizacionForm.valid" class="btn btn-primary">
            {{ editingId ? 'Actualizar' : 'Guardar' }} Cotización
          </button>
          <button type="button" (click)="toggleForm()" class="btn btn-outline">
            Cancelar
          </button>
        </div>
      </form>
    </div>
  </div>

   Quotations List 
  <div class="table-section">
    <div class="card">
      <h3>Lista de Cotizaciones</h3>

      <div *ngIf="loading" class="loading-message">
        Cargando cotizaciones...
      </div>

      <div *ngIf="!loading && cotizaciones.length === 0" class="empty-message">
        No hay cotizaciones para mostrar
      </div>

      <table *ngIf="!loading && cotizaciones.length > 0" class="table">
        <thead>
          <tr>
            <th>Número</th>
            <th>Cliente</th>
            <th>Fecha</th>
            <th>Pasajeros</th>
            <th>Total</th>
            <th>Estado</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let cotizacion of cotizaciones">
            <td>{{ cotizacion.numero }}</td>
            <td>{{ getPersonaName(cotizacion.personaId) }}</td>
            <td>{{ cotizacion.fechaCotizacion | date:'dd/MM/yyyy' }}</td>
            <td>{{ cotizacion.numeroAdultos + cotizacion.numeroNinos }} pax</td>
            <td>{{ cotizacion.total | currency:cotizacion.moneda:'symbol':'1.2-2' }}</td>
            <td>
              <span [class]="'badge ' + getEstadoBadgeClass(cotizacion.estado)">
                {{ cotizacion.estado | titlecase }}
              </span>
            </td>
            <td>
              <button (click)="editCotizacion(cotizacion)" class="btn btn-sm btn-outline">
                Editar
              </button>
              <button (click)="deleteCotizacion(cotizacion.id!)" class="btn btn-sm btn-error">
                Eliminar
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
