<div class="min-h-screen bg-gradient-to-br from-gray-50 to-slate-100">
  <!-- Sidebar Component -->
  <app-sidebar [isCollapsed]="sidebarCollapsed" [menuItems]="sidebarMenuItems" (itemClick)="onSidebarItemClick($event)"
    (toggleSidebar)="onToggleSidebar()">
  </app-sidebar>

  <!-- Main Content Area -->
  <div class="transition-all duration-300" [class.ml-72]="!sidebarCollapsed" [class.ml-20]="sidebarCollapsed">

    <!-- Loading Spinner Global -->
    <div *ngIf="isLoading" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
      <div class="bg-white rounded-xl p-8 flex flex-col items-center gap-4">
        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-everywhere-primary"></div>
        <span class="text-lg font-medium text-gray-700">Cargando liquidación...</span>
      </div>
    </div>

    <!-- Error State -->
    <div *ngIf="error && !isLoading" class="max-w-full mx-auto px-6 py-12">
      <div class="bg-red-50 border border-red-200 rounded-xl p-8 text-center">
        <i class="fas fa-exclamation-triangle text-red-400 text-6xl mb-4"></i>
        <h2 class="text-2xl font-bold text-red-800 mb-2">Error al cargar</h2>
        <p class="text-red-600 mb-6">{{ error }}</p>
        <div class="flex gap-3 justify-center">
          <button (click)="recargarDatos()"
                  class="px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors">
            <i class="fas fa-redo mr-2"></i>
            Reintentar
          </button>
          <button (click)="volverALiquidaciones()"
                  class="px-6 py-2 border border-red-300 text-red-700 rounded-lg hover:bg-red-50 transition-colors">
            <i class="fas fa-arrow-left mr-2"></i>
            Volver a Liquidaciones
          </button>
        </div>
      </div>
    </div>

    <!-- Content when data is loaded -->
    <div *ngIf="liquidacion && !isLoading" class="max-w-full mx-auto">

      <!-- Header Section -->
      <header class="bg-gradient-to-r from-everywhere-primary to-everywhere-secondary text-white relative overflow-hidden">
        <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-white/20 transform skew-x-12"></div>

        <div class="max-w-full mx-auto px-6 py-8 relative z-10">
          <!-- Mobile Menu Button -->
          <button (click)="onToggleSidebar()"
            class="lg:hidden fixed top-4 left-4 z-50 w-12 h-12 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center border border-white/30 hover:bg-white/30 transition-all">
            <i class="fas fa-bars text-xl"></i>
          </button>

          <!-- Breadcrumb -->
          <nav class="mb-6">
            <ol class="flex items-center space-x-2 text-sm">
              <li>
                <button (click)="volverALiquidaciones()"
                        class="text-white/80 hover:text-white transition-colors flex items-center gap-1">
                  <i class="fas fa-credit-card"></i>
                  Liquidaciones
                </button>
              </li>
              <li class="text-white/60">
                <i class="fas fa-chevron-right mx-2"></i>
              </li>
              <li class="text-white font-medium">
                Detalle de Liquidación #{{ liquidacion.numero || liquidacion.id }}
              </li>
            </ol>
          </nav>

          <!-- Header Info -->
          <div class="flex flex-col lg:flex-row justify-between items-start gap-8">
            <div class="flex-1">
              <div class="flex items-center gap-4 mb-4">
                <div class="w-16 h-16 bg-white/20 rounded-2xl flex items-center justify-center">
                  <i class="fas fa-file-invoice text-2xl"></i>
                </div>
                <div>
                  <h1 class="text-3xl font-bold">
                    Liquidación #{{ liquidacion.numero || liquidacion.id }}
                  </h1>
                  <p class="text-white/80 text-lg">
                    Detalle completo de la liquidación
                  </p>
                </div>
              </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex flex-wrap gap-3">
              <button (click)="recargarDatos()"
                      class="px-6 py-3 bg-white/20 backdrop-blur-sm rounded-xl border border-white/30 hover:bg-white/30 transition-all flex items-center gap-2">
                <i class="fas fa-sync-alt"></i>
                <span class="hidden sm:inline">Actualizar</span>
              </button>
              <button (click)="irAEditarLiquidacion()"
                      class="px-6 py-3 bg-white/20 backdrop-blur-sm rounded-xl border border-white/30 hover:bg-white/30 transition-all flex items-center gap-2">
                <i class="fas fa-edit"></i>
                <span class="hidden sm:inline">Editar</span>
              </button>
              <button (click)="volverALiquidaciones()"
                      class="px-6 py-3 bg-white text-everywhere-primary rounded-xl hover:bg-gray-100 transition-colors flex items-center gap-2 font-medium">
                <i class="fas fa-arrow-left"></i>
                <span class="hidden sm:inline">Volver</span>
              </button>
            </div>
          </div>
        </div>
      </header>

      <!-- Main Content -->
      <div class="px-6 py-8">

        <!-- Información General de la Liquidación -->
        <div class="bg-white rounded-xl shadow-lg mb-8 overflow-hidden">
          <div class="bg-gradient-to-r from-gray-50 to-gray-100 px-6 py-4 border-b">
            <h2 class="text-xl font-bold text-gray-800 flex items-center gap-2">
              <i class="fas fa-info-circle text-everywhere-primary"></i>
              Información General
            </h2>
          </div>

          <div class="p-6">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
              <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg p-4 border border-blue-200">
                <div class="text-sm text-blue-600 mb-1 font-medium">Número</div>
                <div class="text-2xl font-bold text-blue-800">{{ liquidacion.numero || 'N/A' }}</div>
              </div>

              <div class="bg-gradient-to-br from-green-50 to-green-100 rounded-lg p-4 border border-green-200">
                <div class="text-sm text-green-600 mb-1 font-medium">Fecha de Compra</div>
                <div class="text-lg font-semibold text-green-800">
                  {{ liquidacion.fechaCompra ? (liquidacion.fechaCompra | date:'dd/MM/yyyy') : 'N/A' }}
                </div>
              </div>

              <div class="bg-gradient-to-br from-purple-50 to-purple-100 rounded-lg p-4 border border-purple-200">
                <div class="text-sm text-purple-600 mb-1 font-medium">Destino</div>
                <div class="text-lg font-semibold text-purple-800">{{ liquidacion.destino || 'N/A' }}</div>
              </div>

              <div class="bg-gradient-to-br from-orange-50 to-orange-100 rounded-lg p-4 border border-orange-200">
                <div class="text-sm text-orange-600 mb-1 font-medium">Número de Pasajeros</div>
                <div class="text-2xl font-bold text-orange-800">{{ liquidacion.numeroPasajeros || 'N/A' }}</div>
              </div>
            </div>

            <!-- Información adicional si está disponible -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mt-6" *ngIf="liquidacion.producto || liquidacion.formaPago">
              <div class="bg-gray-50 rounded-lg p-4" *ngIf="liquidacion.producto">
                <div class="text-sm text-gray-600 mb-1">Producto</div>
                <div class="text-lg font-semibold text-gray-800">{{ liquidacion.producto.descripcion }}</div>
                <div class="text-sm text-gray-500">{{ liquidacion.producto.tipo }}</div>
              </div>

              <div class="bg-gray-50 rounded-lg p-4" *ngIf="liquidacion.formaPago">
                <div class="text-sm text-gray-600 mb-1">Forma de Pago</div>
                <div class="text-lg font-semibold text-gray-800">{{ liquidacion.formaPago.descripcion }}</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Resumen de Totales -->
        <div class="bg-white rounded-xl shadow-lg mb-8 overflow-hidden">
          <div class="bg-gradient-to-r from-gray-50 to-gray-100 px-6 py-4 border-b">
            <h2 class="text-xl font-bold text-gray-800 flex items-center gap-2">
              <i class="fas fa-calculator text-everywhere-primary"></i>
              Resumen de Totales
            </h2>
          </div>

          <div class="p-6">
            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4">
              <div class="bg-blue-50 rounded-lg p-4 text-center border border-blue-200">
                <div class="text-sm text-blue-600 mb-1">Costo Tickets</div>
                <div class="text-xl font-bold text-blue-800">
                  {{ totalCostoTickets | currency:'USD':'symbol':'1.2-2' }}
                </div>
              </div>

              <div class="bg-indigo-50 rounded-lg p-4 text-center border border-indigo-200">
                <div class="text-sm text-indigo-600 mb-1">Cargo Servicio</div>
                <div class="text-xl font-bold text-indigo-800">
                  {{ totalCargoServicio | currency:'USD':'symbol':'1.2-2' }}
                </div>
              </div>

              <div class="bg-green-50 rounded-lg p-4 text-center border border-green-200">
                <div class="text-sm text-green-600 mb-1">Valor Venta</div>
                <div class="text-xl font-bold text-green-800">
                  {{ totalValorVenta | currency:'USD':'symbol':'1.2-2' }}
                </div>
              </div>

              <div class="bg-red-50 rounded-lg p-4 text-center border border-red-200">
                <div class="text-sm text-red-600 mb-1">Descuentos</div>
                <div class="text-xl font-bold text-red-800">
                  {{ totalMontoDescuento | currency:'USD':'symbol':'1.2-2' }}
                </div>
              </div>

              <div class="bg-cyan-50 rounded-lg p-4 text-center border border-cyan-200">
                <div class="text-sm text-cyan-600 mb-1">Pago USD</div>
                <div class="text-xl font-bold text-cyan-800">
                  {{ totalPagoPaxUSD | currency:'USD':'symbol':'1.2-2' }}
                </div>
              </div>

              <div class="bg-teal-50 rounded-lg p-4 text-center border border-teal-200">
                <div class="text-sm text-teal-600 mb-1">Pago PEN</div>
                <div class="text-xl font-bold text-teal-800">
                  {{ totalPagoPaxPEN | currency:'PEN':'symbol':'1.2-2' }}
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Tabla de Detalles -->
        <div class="bg-white rounded-xl shadow-lg overflow-hidden">
          <div class="bg-gradient-to-r from-gray-50 to-gray-100 px-6 py-4 border-b">
            <h2 class="text-xl font-bold text-gray-800 flex items-center gap-2">
              <i class="fas fa-table text-everywhere-primary"></i>
              Detalles de Liquidación
              <span class="ml-auto text-sm bg-everywhere-primary text-white px-3 py-1 rounded-full">
                {{ liquidacion.detalles?.length || 0 }} registro(s)
              </span>
            </h2>
          </div>

          <!-- Tabla Responsiva -->
          <div class="overflow-x-auto">
            <table class="w-full">
              <thead class="bg-gradient-to-r from-everywhere-primary to-everywhere-secondary text-white">
                <tr>
                  <th class="px-4 py-4 text-left text-sm font-semibold min-w-[140px] sticky left-0 bg-gradient-to-r from-everywhere-primary to-everywhere-secondary z-10">
                    Cliente (Viajero)
                  </th>
                  <th class="px-4 py-4 text-left text-sm font-semibold min-w-[120px]">Producto</th>
                  <th class="px-4 py-4 text-left text-sm font-semibold min-w-[120px]">Proveedor</th>
                  <th class="px-4 py-4 text-left text-sm font-semibold min-w-[140px]">Nro de Ticket o File</th>
                  <th class="px-4 py-4 text-left text-sm font-semibold min-w-[100px]">Operador</th>
                  <th class="px-4 py-4 text-right text-sm font-semibold min-w-[120px]">Costo de Ticket</th>
                  <th class="px-4 py-4 text-right text-sm font-semibold min-w-[130px]">Cargo por Servicio</th>
                  <th class="px-4 py-4 text-right text-sm font-semibold min-w-[110px]">Valor Venta</th>
                  <th class="px-4 py-4 text-left text-sm font-semibold min-w-[160px]">Fact X Com A Provee</th>
                  <th class="px-4 py-4 text-left text-sm font-semibold min-w-[160px]">Boleta/Fact/REC/ A Pasajero</th>
                  <th class="px-4 py-4 text-right text-sm font-semibold min-w-[130px]">Monto Descontado</th>
                  <th class="px-4 py-4 text-right text-sm font-semibold min-w-[130px]">Pago de Pax en USD</th>
                  <th class="px-4 py-4 text-right text-sm font-semibold min-w-[130px]">Pago Pax PEN</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let detalle of liquidacion.detalles; let i = index; trackBy: trackByDetalle; let odd = odd"
                    [class.bg-gray-50]="odd"
                    class="border-b border-gray-200 hover:bg-blue-50 transition-colors">

                  <!-- Cliente (Viajero) - Sticky column -->
                  <td class="px-4 py-4 text-sm sticky left-0 z-10" [class.bg-gray-50]="odd" [class.bg-white]="!odd">
                    <div class="flex flex-col min-w-[120px]">
                      <span class="font-medium text-gray-800">{{ detalle.viajero?.nombres || 'N/A' }}</span>
                      <span class="text-xs text-gray-500">
                        {{ detalle.viajero?.apellidoPaterno || '' }} {{ detalle.viajero?.apellidoMaterno || '' }}
                      </span>
                    </div>
                  </td>

                  <!-- Producto -->
                  <td class="px-4 py-4 text-sm">
                    <div class="flex flex-col">
                      <span class="text-gray-800 font-medium">{{ detalle.producto?.descripcion || 'N/A' }}</span>
                      <span class="text-xs text-gray-500">{{ detalle.producto?.tipo || '' }}</span>
                    </div>
                  </td>

                  <!-- Proveedor -->
                  <td class="px-4 py-4 text-sm">
                    <span class="text-gray-800">{{ detalle.proveedor?.nombre || 'N/A' }}</span>
                  </td>

                  <!-- Nro de Ticket o File -->
                  <td class="px-4 py-4 text-sm">
                    <span class="font-mono text-gray-800 bg-gray-100 px-2 py-1 rounded">
                      {{ detalle.ticket || 'N/A' }}
                    </span>
                  </td>

                  <!-- Operador -->
                  <td class="px-4 py-4 text-sm">
                    <span class="text-gray-800">{{ detalle.operador?.nombre || 'N/A' }}</span>
                  </td>

                  <!-- Costo de Ticket -->
                  <td class="px-4 py-4 text-sm text-right">
                    <span class="font-semibold text-blue-600">
                      {{ detalle.costoTicket ? (detalle.costoTicket | currency:'USD':'symbol':'1.2-2') : 'N/A' }}
                    </span>
                  </td>

                  <!-- Cargo por Servicio -->
                  <td class="px-4 py-4 text-sm text-right">
                    <span class="font-semibold text-indigo-600">
                      {{ detalle.cargoServicio ? (detalle.cargoServicio | currency:'USD':'symbol':'1.2-2') : 'N/A' }}
                    </span>
                  </td>

                  <!-- Valor Venta -->
                  <td class="px-4 py-4 text-sm text-right">
                    <span class="font-semibold text-green-600">
                      {{ detalle.valorVenta ? (detalle.valorVenta | currency:'USD':'symbol':'1.2-2') : 'N/A' }}
                    </span>
                  </td>

                  <!-- Factura Compra -->
                  <td class="px-4 py-4 text-sm">
                    <span class="text-gray-800">{{ detalle.facturaCompra || 'N/A' }}</span>
                  </td>

                  <!-- Boleta Pasajero -->
                  <td class="px-4 py-4 text-sm">
                    <span class="text-gray-800">{{ detalle.boletaPasajero || 'N/A' }}</span>
                  </td>

                  <!-- Monto Descontado -->
                  <td class="px-4 py-4 text-sm text-right">
                    <span class="font-semibold text-red-600">
                      {{ detalle.montoDescuento ? (detalle.montoDescuento | currency:'USD':'symbol':'1.2-2') : 'N/A' }}
                    </span>
                  </td>

                  <!-- Pago Pax USD -->
                  <td class="px-4 py-4 text-sm text-right">
                    <span class="font-semibold text-cyan-600">
                      {{ detalle.pagoPaxUSD ? (detalle.pagoPaxUSD | currency:'USD':'symbol':'1.2-2') : 'N/A' }}
                    </span>
                  </td>

                  <!-- Pago Pax PEN -->
                  <td class="px-4 py-4 text-sm text-right">
                    <span class="font-semibold text-teal-600">
                      {{ detalle.pagoPaxPEN ? (detalle.pagoPaxPEN | currency:'PEN':'symbol':'1.2-2') : 'N/A' }}
                    </span>
                  </td>
                </tr>

                <!-- Empty State -->
                <tr *ngIf="!liquidacion.detalles || liquidacion.detalles.length === 0">
                  <td colspan="13" class="px-4 py-12 text-center text-gray-500">
                    <div class="flex flex-col items-center gap-4">
                      <i class="fas fa-inbox text-6xl text-gray-300"></i>
                      <div>
                        <h3 class="text-xl font-medium text-gray-600 mb-2">No hay detalles registrados</h3>
                        <p class="text-gray-500">Esta liquidación no tiene detalles asociados.</p>
                      </div>
                      <button (click)="irAEditarLiquidacion()"
                              class="px-6 py-2 bg-everywhere-primary text-white rounded-lg hover:bg-everywhere-secondary transition-colors">
                        <i class="fas fa-plus mr-2"></i>
                        Agregar Detalles
                      </button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Footer with actions -->
        <div class="mt-8 flex flex-col sm:flex-row gap-4 justify-between items-center">
          <div class="text-sm text-gray-600">
            Liquidación creada el {{ liquidacion.creado | date:'dd/MM/yyyy HH:mm' }}
            <span *ngIf="liquidacion.actualizado && liquidacion.actualizado !== liquidacion.creado">
              • Última actualización: {{ liquidacion.actualizado | date:'dd/MM/yyyy HH:mm' }}
            </span>
          </div>

          <div class="flex gap-3">
            <button (click)="recargarDatos()"
                    class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors text-sm">
              <i class="fas fa-sync-alt mr-2"></i>
              Actualizar
            </button>
            <button (click)="volverALiquidaciones()"
                    class="px-6 py-2 bg-everywhere-primary text-white rounded-lg hover:bg-everywhere-secondary transition-colors">
              <i class="fas fa-arrow-left mr-2"></i>
              Volver a Liquidaciones
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
